<!DOCTYPE html>
<html>
<head>
    <title>Spotify Authorization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #191414;
            color: #fff;
        }
        button {
            background: #1DB954;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #1ed760;
        }
        .token-box {
            background: #282828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            word-break: break-all;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #282828;
            border-radius: 8px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #444;
            background: #333;
            color: #fff;
            border-radius: 4px;
        }
        code {
            background: #000;
            padding: 2px 6px;
            border-radius: 3px;
            color: #1DB954;
        }
    </style>
</head>
<body>
    <h1>üéµ Spotify Playlist Authorization</h1>
    
    <div class="step">
        <h2>Step 1: Enter Your Spotify Credentials</h2>
        <p>Get these from your .env file:</p>
        <input type="text" id="clientId" placeholder="Your Spotify Client ID">
        <input type="text" id="clientSecret" placeholder="Your Spotify Client Secret">
    </div>

    <div class="step">
        <h2>Step 2: Authorize</h2>
        <button onclick="authorize()">Login with Spotify</button>
        <p><small>You'll be redirected to Spotify to authorize the app</small></p>
    </div>

    <div id="step3" class="step" style="display:none;">
        <h2>Step 3: Get Your Refresh Token</h2>
        <p>After authorization, you'll be redirected back. Click here:</p>
        <button onclick="getTokens()">Get Refresh Token</button>
        <div id="result"></div>
    </div>

    <script>
        const REDIRECT_URI = 'https://ourstoriesalbum.vercel.app/spotify-auth.html';
        const SCOPES = 'playlist-modify-public playlist-modify-private';

        function authorize() {
            const clientId = document.getElementById('clientId').value;
            if (!clientId) {
                alert('Please enter your Client ID');
                return;
            }
            
            localStorage.setItem('spotify_client_id', clientId);
            localStorage.setItem('spotify_client_secret', document.getElementById('clientSecret').value);
            
            const authUrl = `https://accounts.spotify.com/authorize?` +
                `client_id=${clientId}&` +
                `response_type=code&` +
                `redirect_uri=${encodeURIComponent(REDIRECT_URI)}&` +
                `scope=${encodeURIComponent(SCOPES)}`;
            
            window.location.href = authUrl;
        }

        async function getTokens() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (!code) {
                alert('No authorization code found. Please authorize first.');
                return;
            }

            const clientId = localStorage.getItem('spotify_client_id');
            const clientSecret = localStorage.getItem('spotify_client_secret');

            const response = await fetch('https://accounts.spotify.com/api/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Authorization': 'Basic ' + btoa(clientId + ':' + clientSecret)
                },
                body: new URLSearchParams({
                    grant_type: 'authorization_code',
                    code: code,
                    redirect_uri: REDIRECT_URI
                })
            });

            const data = await response.json();
            
            if (data.refresh_token) {
                document.getElementById('result').innerHTML = `
                    <h3>‚úÖ Success! Copy this to your .env file:</h3>
                    <div class="token-box">
                        <p><strong>Add this line to your .env:</strong></p>
                        <code>VITE_SPOTIFY_REFRESH_TOKEN=${data.refresh_token}</code>
                    </div>
                    <p>‚ö†Ô∏è Keep this token secret! Don't share it or commit it to GitHub.</p>
                `;
            } else {
                document.getElementById('result').innerHTML = `
                    <p style="color: #ff4444;">‚ùå Error: ${JSON.stringify(data)}</p>
                `;
            }
        }

        // Check if we're on the callback
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('code')) {
                document.getElementById('step3').style.display = 'block';
            }
        };
    </script>
</body>
</html>